@page "/authentication/{action}"
@inject ILogger<Authentication> Logger
@inject HttpClient Http
<RemoteAuthenticatorView @ref="authenticator" Action="@Action" OnLogInSucceeded="LoginSucceeded" />

@code{
    [Parameter] public string? Action { get; set; }
    RemoteAuthenticatorView authenticator = null!;

    async Task LoginSucceeded()
    {
        Logger.LogInformation("Login succeeded.");
        try
        {
            var response = PostResponse.Create(await Http.PostAsJsonAsync($"api/app/register", new { }));
            if (response is not PostResponse.Success)
            {
                throw new InvalidOperationException("Register login was unsuccesfull.");
            }
        }
        catch (Exception ex)
        {
            Logger.LogWarning(ex, "Failed to register login.");
            //TODO logout
        }
    }
}
